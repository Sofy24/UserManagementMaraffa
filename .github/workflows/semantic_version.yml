#Remeber to block commit on main branch
name: Changelog
on:
  # pull_request:
  #   types:
  #     - closed
  push:
    branches:
      - main
    tags:
      - '*'

jobs:
  changelog:
    if: startsWith(github.ref, 'refs/tags/')
    runs-on: ubuntu-22.04
    permissions:
      contents: write
    steps:
      # - uses: actions/checkout@v4
      # - name: Bump version and push tag
      #   id: tag_version
      #   uses: mathieudutour/github-tag-action@v6.2
      #   with:
      #     github_token: ${{ secrets.ACTION_TOKEN }}
      # - name: Create a GitHub release
      #   uses: ncipollo/release-action@v1
      #   with:
      #     tag: ${{ steps.tag_version.outputs.new_tag }}
      #     name: Release ${{ steps.tag_version.outputs.new_tag }}
      #     body: ${{ steps.tag_version.outputs.changelog }}
    # - name: Checkout 
    #   uses: actions/checkout@v3
    #   with:
    #     ref: ${{ github.event.pull_request.merge_commit_sha }}
    #     fetch-depth: '0'

    # - name: Bump version and push tag
    #   uses: anothrNick/github-tag-action@1.64.0 # Don't use @master or @v1 unless you're happy to test the latest version
    #   env:
    #     verbose: true
    #     GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} # if you don't want to set write permissions use a PAT token
    #     WITH_V: true
    #     INITIAL_VERSION: 1.0.0
    #     PRERELEASE: false
    - uses: BobAnkh/auto-generate-changelog@v1.2.5
      with:
        ACCESS_TOKEN: ${{ secrets.CHANGELOG }}
        PATH: 'CHANGELOG.md'
        COMMIT_MESSAGE: 'docs(CHANGELOG): update release notes'
        TYPE: 'feat:Feature,fix:Bug Fixes,docs:Documentation,refactor:Refactor,perf:Performance Improvements,CI: Continuos Integration'
    # - name: Release
    #   uses: softprops/action-gh-release@v2
  # automatic_release:
  #   if: github.event.pull_request.merged == true
  #   permissions:
  #     contents: write
  #   runs-on: "ubuntu-latest"
  #   steps:
  #     - uses: "marvinpinto/action-automatic-releases@latest"
  #       with:
  #         repo_token: ${{ secrets.GITHUB_TOKEN }}
  #         automatic_release_tag: "latest"
  #         prerelease: false




    
